# 프로세스 vs 스레드

## 프로세스

- 메모리에 올라와서 실행되고 있는 프로그램의 인스턴스 (독립적인 개체)
- **운영체제로부터 시스템 자원을 할당받는 작업의 단위**



![img](https://gmlwjd9405.github.io/images/os-process-and-thread/process.png)

- 프로세스는 Code, Data, Stack, Heap (각각 독립된 메모리 영역)을 할당받는다.
  - Code : 프로그램의 실제 코드 저장
  - Data : 프로세스가 실행될 때 정의된 전역 변수, static 변수 저장
  - Stack : 함수에서 다른 함수를 실행하는 등의 서브루틴 정보 저장(❗️재귀와 스택이 관련 있는 이유)
  - Heap : 런타임 중 동적으로 할당받는 변수들 저장 (함수 내에서 선언된 변수 등)

- 프로세스 당 기본적으로 최소 1개의 스레드(메인 스레드)를 가지고 있다.

각 프로세스는 별도의 주소 공간에서 실행되며, 한 프로세스는 다른 프로세스의 변수나 자료구조에 접근할 수 없다.

- 한 프로세스가 다른 프로세스의 자원에 접근하려면 프로세스 간 통신 (IPC, Inter-Process-Communication)을 사용해야 한다. (ex. 파이프, 파일, 소캣)



## 스레드

- 프로세스 내에서 실행되는 흐름의 단위

- **프로세스가 할당받은 자원을 이용하는 실행의 단위**

  

  ![img](https://gmlwjd9405.github.io/images/os-process-and-thread/thread.png)

- 프로세스 내에서 Stack만 따로 할당받고, Code, Data, Heap 영역 (주소 공간이나 자원)은 공유한다.

- 한 스레드가 프로세스 자원을 변경하면, 다른 이웃 스레드 (sibling thread)도 그 변경 결과를 즉시 볼 수 있다.



### 멀티 프로세스 대신 멀티 스레드를 사용하는 이유?

시스템 자원을 효율적으로 관리하기 위해.

쉽게 말하면, 프로그램을 여러 개 켜는 것보다 하나의 프로그램 안에서 여러 작업을 해결하는 것이다.

멀티 프로세스로 할 수 있는 작업을 멀티 스레드로 실행할 경우, 프로세스를 생성해 자원을 할당하는 **시스템 콜이 줄어들어** 자원을 효율적으로 관리할 수 있다. 뿐만 아니라, **프로세스 간의 통신(IPC)보다 스레드 간 통신 비용이 적으므로** 작업들 간의 통신의 부담이 줄어든다.





### 자바의 스레드?

- **자바에는 프로세스가 존재하지 않고, 스레드만 존재한다!**
- JVM이 운영체제 역할을 한다. (자원 할당)
- 자바에서 스레드 스케줄링은 전적으로 JVM에 의해 이루어진다. 스레드와 관련된 많은 정보들도 JVM이 관리한다.
  - 메인 스레드 생성 (작업 스레드들은 JVM이 아닌 메인 스레드가 만든다)
  - 스레드가 몇 개 존재하는지
  - 스레드로 실행되는 프로그램 코드의 메모리 위치는 어디인지
  - 스레드의 상태는 무엇인지
  - 스레드 우선순의는 얼마인지





## 멀티 프로세스 vs 멀티 스레드

### 멀티 프로세싱이란?

하나의 응용프로그램을 여러 개의 프로세스로 구성해 각 프로세스가 하나의 작업(태스크)를 처리하도록 하는 것이다.

ex. 구글 크롬 탭

👍 여러 개의 자식 프로세스 중 하나에 문제가 발생하면, 그 자식 프로세스만 죽는다. (다른 프로세스에 영향이 없다.)

👎 Context Switching 오버헤드

​	Context Switching 과정에서 캐시 메모리 초기화 등 무거운 작업이 진행되고, 많은 시간이 소모되는 등 오버헤드가 발생한다.  
​	프로세스는 각각의 독립된 메모리 영역을 할당받았기 때문에 프로세스 사이에서 공유하는 메모리가 없어, Context Switching이 발생하면 캐시 레지스터(이건 하나 뿐이다)에 있는 모든 데이터를 모두 리셋하고, 다시 캐시 정보를 불러와야 한다.

​		**A 프로세스 진행 중 -> B 레지스터 실행하려고 한다. -> 캐시 레지스터에 저장되어 있던 B 프로세스를 꺼내고, A 프로세스를 저장한다. -> 다시 A를 하려고 하면 -> 캐시 레지스터에 저장되어 있던 A 프로세스를 꺼내고, B 프로세스를 집어넣는다. ** 

👎 프로세스 간 어렵고 복잡한 통신 기법 IPC

​	프로세스는 각각 독립된 메모리 영역을 할당받았기 때문에, 하나의 프로그램에 속하는 프로세스들 사이에 변수를 공유할 수 없다.



### 멀티 스레딩이란?

하나의 응용프로그램을 여러 개의 스레드로 구성하고, 각 스레드가 하나의 작업을 처리하도록 하는 것이다.

ex. 웹 서버, ???

👍 빠른 Context Switching

​	스레드 간 데이터를 주고받는 게 간단해지고, 시스템 자원 소모가 줄어든다. (스레드 사이의 작업량이 적다)

👍 간단한 통신 방법으로 인한 프로그램 응답 시간 단축

​	스레드는 프로세스 내의 stack 영역을 제외한 모든 메모리를 공유하기 때문에 통신의 부담이 적다.

👎 주의 깊은 설계가 필요하다.

👎 디버깅이 까다롭다.

👎 자원 공유로 인한 동기화 문제가 발생한다. (동시에 사용할 때 충돌 발생)

👎 하나의 스레드에 문제가 발생하면 전체 프로세스가 영향을 받는다.







> Context Switching

CPU에서 여러 프로세스를 돌아가면서 작업을 처리하는데, 이 과정을 Context Switching이라 한다.

구체적으로, 동작 중인 프로세스가 대기하면서 해당 프로세스의 상태(Context)를 보관하고, 대기하고 있던 다음 순서의 프로세스가 동작하면서 이전에 보관했던 프로세스의 상태를 복구하는 작업을 말한다.







> 참고
>
> https://gmlwjd9405.github.io/2018/09/14/process-vs-thread.html  
> 

