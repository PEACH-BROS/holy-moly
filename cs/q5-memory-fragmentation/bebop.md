# 메모리 단편화에 대해 설명하세요



## 종류

메모리 단편화의 종류는 **내부 단편화**와 **외부 단편화** 두 가지가 있다.

### 내부 단편화

내부 단편화는 프로세스가 실제 사용하는 메모리보다 더 큰 메모리를 할당 받을 경우에 발생한다.

이러한 경우 **메모리의 낭비**가 생긴다.

![image](https://user-images.githubusercontent.com/13347548/85362158-b82e1a00-b558-11ea-812b-9d811006154f.png)

위 그림과 같이 **프로세스가 필요한 메모리는 3KB** 인데 **OS가 할당해준 메모리가 4KB**라면 **1KB의 내부 단편화**가 발생한다.

### 외부 단편화

외부 단편화는 **OS에 가용한 메모리의 합**이 **프로세스가 필요한 메모리보다 커**서 충분해 보이지만  
서로 연속적으로 위치해 있지 않기 때문에 **프로세스에게 필요한 메모리를 할당 할 수 없는 상태**를 말한다.



![image](https://user-images.githubusercontent.com/13347548/85362414-528e5d80-b559-11ea-8f00-57d3357f10e7.png)

위 그림과 같이 가용한 메모리의 합(**4KB**)이 프로세스가 필요한 메모리(**4KB**)만큼 충분하지만  
가용한 메모리가 서로 분리되어(**2KB, 2KB**) 있기 때문에 프로세스에게 메모리를 할당 할 수 없는 상태이다.

## 해결방법

### 페이징 - 외부 단편화 해결

물리 메모리를 사용 할 때  
고정된 크기의 메모리를 프레임 단위로 나누어 사용하면서 연속되지 않은 메모리들이 발생하였다.

이러한 문제를 해결하기 위해 **가상 메모리** 계층을 두고  
**매핑 테이블을 이용**하여 실제로 단편화되어 있는, **연속적이지 않은 물리적 메모리를 사용**함으로써  
**외부 단편화 문제를 해결**할 수 있게된다.



![image](https://user-images.githubusercontent.com/13347548/85365536-87ea7980-b560-11ea-9cd7-277b7f8ec4cc.png)

**물리적 메모리**를 고정된 크기로 나눈 것을 **프레임**  
**가상 메모리**를 고정된 크기로 나눈 것을 **페이지** 라고 부른다.

이때 **페이지는 모두 같은 크기**로 나누어야 한다.

### 세그멘테이션 - 내부 단편화 해결

**페이징**은 가상 메모리를 모두 **같은 크기**로 나누었지만  
**세그멘테이션**은 가상 메모리를 **필요할 때마다** **서로 다른 단위인 세그먼트**로 나누어 할당한다.

서로 다른 단위로 세그먼트를 나누어 할당 할 수 있기 때문에  
내부단편화가 발생하지 않도록 프로세스가 **필요한 만큼만 메모리를 할당**할 수 있다.

페이징 기법과 마찬가지로 세그먼트 테이블이 필요하다.

세그멘트 테이블은 세그먼트들의 정보가 담겨있는데  
세그먼트의 시작주소(base), 세그먼트의 크기(limit)를 가지고 있다.

![image](https://user-images.githubusercontent.com/13347548/85366894-34c5f600-b563-11ea-90cd-7f9f05b7b392.png)

하지만 외부 단편화 문제가 심각하기 때문에 페이징을 쓰는게 더 좋은것 같다.