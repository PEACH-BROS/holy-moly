# DeadLock 이 뭔가요? 해결 방법은?

[비밥의 데드락](bebop.md)

[코일의 데드락](coyle.md)

[스티치의 데드락](stitch.md)

[엘리의 데드락](elly-dead-lock.md)

---

## Deadlock

: 교착 상태.

프로세스가 원하는 자원을 다른 프로세스가 물고 있을 때, 프로세스를 계속 진행하지도 못하고 끝내지도 못하는, 이도저도 못하는 상황을 의미한다.

## 데드락 발생 조건 4가지

❗️ 4가지가 동시에 성립해야 데드락이 발생한다.

1. **상호 배제**

   자원은 한 번에 하나의 프로세스에만 할당될 수 있다.

2. **점유 상태로 대기**

   최소한 하나의 자원을 점유하고 있으면서, 다른 프로세스에 이미 할당된 자원을 추가로 점유하기 위해 대기하는 프로세스가 존재한다.

3. **선점 불가**

   다른 프로세스에 할당된 자원은 사용이 끝날 때까지 강제로 뺏을 수 없다.

4. **순환성 대기**

   프로세스 1은 2가 점유한 자원을 대기하고, 2는 3이 점유한 자원을 대기하고 ... N은 1이 점유한 자원을 필요로 할 경우

![image](https://user-images.githubusercontent.com/19922698/88691346-b77c3b00-d137-11ea-850d-b97c7d3e5e0b.png)

## 해결 방법 4가지

### 1. 예방

위의 4가지 조건 중 하나가 발생할 수 없도록 예방하는 방법

1. **상호 배제 부정**

   여러 개의 프로세스가 공유 자원을 사용할 수 있도록 한다.

2. **점유 대기 부정**

   프로세스가 실행되기 전 모든 필요한 자원을 할당한다.

3. **비선점 부정**

   자원을 점유하고 있는 프로세스가 다른 자원을 요구할 때 점유 중인 자원을 반납하고, 요구한 자원을 사용하기 위해 대기한다.

4. **순환 대기 부정**

   자원에 고유 번호를 할당하고, 번호 순서대로 자원을 요구하도록 한다.

### 2. 회피

**은행원 알고리즘 (Banker's Algorithm)**

프로세스가 자원을 요구할 때, 시스템은 이 친구한테 자원을 할당한 후에도 안정 상태인지를 사전에 검사하여 교착 상태를 회피한다. (안정 상태가 아니면 다른 프로세스가 자원을 반납할 때까지 대기함)

![image](https://user-images.githubusercontent.com/19922698/88692693-55243a00-d139-11ea-9603-98c974c29c47.png)

### 은행원 알고리즘의 단점 및 주의사항

- 할당할 수 있는 자원의 수가 일정해야 합니다.

- 사용자 수가 일정해야 합니다.

- 항상 불안전 상태를 방지해야 하므로 자원 이용도가 낮습니다.

- 최대 자원 요구량을 미리 알아야 합니다.

- 프로세스들은 유한한 시간 안에 자원을 반납해야 합니다.

### 3. 탐지 및 회복

#### 교착 상태 탐지

자원 할당 그래프를 통해 교착 상태를 탐지한다.

자원 할당 그래프에서 Cycle ( *순환* )이 발견되면 교착 상태의 가능성이 있다고 본다.

반드시 순환이 발견된다고 교착 상태에 빠지는 것은 아니고 프로세스가 자원을 반납한 상황을 가정해 보았을 때도 순환이 풀리지 않는다면 교착 상태라고 본다. 

교착 상태에 빠진 순환

![image](https://user-images.githubusercontent.com/13347548/88688402-3f604600-d134-11ea-90f7-0f2840eb0bbf.png)

교착 상태에 빠지지 않은 순환

![image](https://user-images.githubusercontent.com/13347548/88688518-63238c00-d134-11ea-88ef-f8fcdf6d784a.png)

#### 교착 상태 회복

교착 상태가 발생하면 프로세스를 종료하거나, 할당된 자원을 해제하여 교착상태를 회복하는 것을 의미한다.

프로세스를 종료하는 방식은 **교착상태의 프로세스를 모두 중지**시키는 방법과, **교착 상태가 제거될 때 까지 프로세스를 하나씩 중지** 시키는 방식이 있다.

회복하는 방식은 교착 상태에 빠진 프로세스가 점유한 자원을 빼앗아( 선점 ) 다른 프로세스에게 할당하고 빼앗긴 프로세스는 일시 정지 시키는 방식이다.

보통 우선 순위가 낮은 프로세스, 수행된 횟수가 적은 프로세스를 위주로 자원을 빼앗아 간다.

### 4. 무시

사실 대부분의 시스템에서는 교착 상태가 잘 발생하지 않고, 예방, 회피, 탐지, 회복에는 많은 비용이 든다.