# HTTPS

**HTTP + SSL = HTTPS**

**HTTPS?** 보안이 강화된 HTTP.

HTTP는 암호화되지 않은 상태로 통신하기 때문에, 서로 주고받는 메시지를 알아내기 쉽다.

그래서 비밀번호나 계좌번호 등 중요한 데이터를 주고받을 때에는 HTTPS 프로토콜을 사용해야 한다.

![image](https://user-images.githubusercontent.com/19922698/85678715-b5235d00-b703-11ea-992a-6d8cab7cacbe.png)

**SSL?** Secure Socket Layer

**SSL 인증서**를 통해 클라이언트-서버 간 통신을 제 3자가 보증해준다.

클라이언트가 서버에 접속한 직후에 서버는 클라이언트에게 이 인증서를 전달한다. 그럼 클라이언트는 데이터를 보내기 전에, 이 인증서를 보고 신뢰할 수 있는 서버인지 확인한다.



## SSL 암호화 종류

### 1. 대칭키

동일한 키로 암호화/복호화 할 수 있는 방법

❗️**단점** : 대칭키가 유출돼버리면 아무나 복호화가 가능하다. (HTTPS의 의미 상실)

### 2. 공개키

서로 다른 키(비밀키, 공개키)로 암호화/복호화를 진행한다.

A키로 암호화하면 B키로 복호화할 수 있고, B키로 암호화하면 A키로 복호화할 수 있다. 두 개의 키 중 하나를 비밀키로, 하나를 공개키로 지정한다. 비밀키는 자신만 갖고 있고, 공개키는 타인에게 제공한다.

공개키를 제공받은 상대는 공개키를 이용해 정보를 암호화하고, 암호화된 정보는 내가 비밀키를 이용해 복호화한다. 이 과정에서 공개키가 유출되어도, 비공개키를 모르면 복호화할 수 없기 때문에 안전하다.

```
클라이언트가 서버로부터 받은 키(공개키)를 가지고 "hello"(정보)를 암호화해 서버에게 "@&%#&^%*"(암호화된 정보)를 전달한다. -> 서버는 클라이언트가 보낸 암호화된 정보를 비밀키로 복호화해서 "hello"라는 것을 확인한다.
```

반대로, 비밀키를 이용해 암호화하고, 공개키를 이용해 복호화하는 방법도 있다. (데이터를 보호할 목적이 아닌, 데이터를 제공한 사람의 신원 보장을 위해 사용된다. 비밀키-공개키는 한 쌍을 이루기 때문에 가능하다. 이를 **전자서명**이라고 부른다.)

비밀키 소유자는 비밀키를 이용해 정보를 암호화한 후, 





## 그럼 어떻게 통신하지?

![image](https://user-images.githubusercontent.com/19922698/85687848-32eb6680-b70c-11ea-90fa-5b5138c5f6a2.png)

​										출처 : https://wayhome25.github.io/cs/2018/03/11/ssl-https/

### 1. Client Hello

클라이언트가 브라우저를 통해 서버에 접속한다.

이 때, 클라이언트는 랜덤한 데이터를 생성해 서버에게 전송한다. 또, 현재 지원 가능한 암호화 방식을 서버에게 전달한다. (클라이언트의 능력을 서버에게 말해주기)

### 2. Server Hello

Client Hello에 대한 응답.

서버에서 생성한 랜덤한 데이터를 클라이언트에게 전송한다.

서버는 클라이언트가 보낸 암호화 방식에 맞춰 현재 서버에서 제공할 수 있는 가장 안전한 암호화 방식 + **인증서**를 클라이언트로 전달한다.

### 3. 클라이언트가 CA(인증기관) 리스트 확인

서버가 보낸 인증서의 발급 기관이 어디인지 클라이언트에 내장된 CA의 공개키를 이용해 복호화한다.

복호화 성공 : 	CA의 개인키로 암호화한 문서임이 보증되고, 서버를 믿을 수 있다.

​						+ 1, 2단계의 랜덤 데이터를 조합해 `pre master secret`  키를 생성한다. 이는 데이터를 주고받을 때 사용한다. 이 키를 서버에게 전송한다.

복호화 실패 :	사용자에게 경고 메시지를 띄운다.



### 4. 서버는 클라이언트에게 받은 키를 서버의 비밀키로 복호화한다.

이렇게 서버-클라이언트 모두 `pre master secret` 값을 공유하게 되었다. 

이 값을 이용해 `master secret` 및 `session key`(대칭키)를 생성한다.



> 참고
>
> https://wayhome25.github.io/cs/2018/03/11/ssl-https/  
> https://aileen93.tistory.com/119  
> https://opentutorials.org/course/228/4894  
> https://wayhome25.github.io/cs/2018/03/11/ssl-https/