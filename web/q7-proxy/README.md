# Forward Proxy, Reverse Proxy, Load Balancer

### 프록시 : 대리, 남을 대신하여 일을 처리함

<br/>

## 프록시의 종류

### Forward Proxy

클라이언트의 End Point는 포워드 프록시이다.  
따라서 클라이언트는 포워드 프록시에 의해 서버에게 자신을 노출시키지 않을수 있다.

포워드 프록시는 아래와 클라이언트가 위치하는 내부망에 같이 위치한다.

❗️ 인터넷에 닿기 전에 Proxy에 닿아야 Forward Proxy가 된다. 그래서 내부망에 위치해야 한다.

<img src="https://user-images.githubusercontent.com/13347548/90537452-4e2c9c80-e1b8-11ea-86de-7afc17299764.png" alt="image" style="zoom:30%;" />

포워드 프록시의 예 

- 인터넷 속도를 향상 시키기 위해 프록시 설정
- 외국에서 접속하는 것처럼 테스트 하기 위해 프록시 설정을 해라
- IP 추적을 방지하기 위해 프록시 설정을 하였다.

포워드 프록시의 장점

1. 캐싱 : 포워드 프록시는 클라이언트의 요청에 대한 응답 결과를 캐싱해두고 동일한 요청이 들어온 경우에 캐시된 결과를 반환한다.  
   캐시된 결과를 받은 클라이언트는 빠른 응답을 받을 수 있고, 서버는 불필요한 요청을 처리할 필요가 없어 부하가 줄어든다.  
   보통 정적 리소스에 대한 정보를 캐싱해두고 응답을 해준다.

   또한 특정 요청(특정 웹사이트)에 대한 요청을 차단을 할 수 있다.

   ![image](https://user-images.githubusercontent.com/19922698/90539261-9351ce00-e1ba-11ea-8e6c-34d47d077f41.png)

2. 익명성 : 클라가 보낸 요청을 감춘다. 

   - 포워드 프록시를 쓰면 ID, 장비 정보, OS 정보들을 받을 수 없다.
   - 포워드 프록시가 존재한다면 서버가 받은 요청에는 클라이언트에서 요청한 것이 아닌 포워드 프록시가 요청한 것으로 보여진다.
   - 즉, Server는 응답 받은 요청을 누가 보냈는지 알지 못하고 Server가 받은 요청 IP는 Proxy IP가 된다.
   - ![image](https://user-images.githubusercontent.com/19922698/90539161-73baa580-e1ba-11ea-8c29-51c25d3e8c57.png)

   <br/>

### Reverse Proxy

리버스 프록시의 End Point 는 실제 서버의 도메인이다.  
따라서 서버는 클라이언트에게 자신을 노출시키지 않을수 있다.

<img src="https://user-images.githubusercontent.com/13347548/90537784-b11e3380-e1b8-11ea-8346-e5062df93229.png" alt="image" style="zoom:33%;" />

리버스 프록시는 맵핑 정보가 존재한다. 맵핑 정보를 기반으로 http요청을 https 요청으로 리다이렉트 하는 방식으로 서버의 보안을 담당하기도 한다.

DMZ는 내부 네트워크와 외부 네트워크사이의 공간을 의미하는데 이 구간에 리버스 프록시가 위치하게 된다.  
WAS를 외부 네트워크와 연결이 가능한 DMZ에 위치 시켜놓으면 WAS가 털리면서 WAS와 연결된 다른 컴포넌트들도 같이 털리게 될 수 있다.   
하지만 리버스 프록시를 이용해서 내부 네트워크에 WAS를 위치 시켜두면 그러한 위험성을 절감할 수 있다.

리버스 프록시의 장점

1. 캐싱
   - 포워드 프록시와 동일
2. 보안
   - 서버 정보를 클라이언트로부터 숨김
   - 클라는 요청할 때 서버를 알지 못하고 리버스 프록시까지 밖에 알 수 없다. 리버스 프록시가 서버의 IP로 요청을 보내준다.
   - 클라는 리버스 프록시를 실제 서버라고 생각하고 요청하고 실제 서버 IP는 노출되지 않는다.
   - ![image](https://user-images.githubusercontent.com/19922698/90539632-0bb88f00-e1bb-11ea-9131-dce57bc6ef8a.png)
3. Load Balancing

<br/>

## Load Balancing

- 부하 분산이 목적
- 해야할 작업을 나누어 서버의 부하를 분산시키는 것

### 로드 밸런서가 나타난 배경

- 스케일 업 : 서버의 하드웨어 성능을 높여보자!
- 스케일 아웃 : 여러 대의 서버가 나누어서 요청을 처리하자.

### 로드 밸런서란 ?

여러 대의 서버가 분산 처리할 수 있도록 요청을 나누어 주는 서비스 

### 로드 밸런서의 종류

- L2 : Mac 주소를 바탕으로 로드 밸런싱
- L3 : IP 주소를 바탕으로 로드 밸런싱
- L4 : 전송 계층 (IP & Port) 레벨에서 로드 밸런싱 (TCP/UDP)
  - URL 로 접근 시 서버 A와 서버 B로 로드 밸런싱 해준다.
- L7 : 응용 계층(User Request) Level 에서 로드 밸런싱(HTTPS/ HTTP / FTP)
  - URL로 접근시 응용 계층 안에서 어느 서버로 보낼지 결정하여 /category와 /search를 담당 서버들로 로드밸런싱

### 로드 밸런서의 동작 방식

서비스에 발생하는 트래픽이 많을 때 여러 대의 서버가 분산처리하여 서버의 로드율 증가, 부하량, 속도저하 등을 고려하여 적절히 분산처리하여 해결해주는 서비스를 담당한다.

WAS들이 위치한 내부망은 사설 IP를 사용하고 있다. 이러한 사설 IP는 클라이언트가 접근할 수 없기 때문에 공인 IP를 이용해서 접근을 해야하는데 로드 밸런서가 사설 IP를 공인 IP로 맵핑해준다. 클라이언트는 이렇게 맵핑된 공인 IP를 이용해서 WAS에 요청을 할 수 있게된다.

이렇게 공인 IP와 사설 IP를 맵핑했다는 것은 클라이언트가 공인 IP로 요청한 목적지 IP 주소를 사설 IP주소로 로드 밸런서가 중간에 바꿔준다는 것을 의미하기도 한다.

여러대의 WAS가 존재할때 로드 밸런서는 어떤 WAS를 선택해서 요청을 하는 것인가?

Round Robin 방식으로 균일하게 부하를 분산하는 방식도 있고, 가장 적은 커넥션을 맺고있는 WAS를 탐색해서 부하를 분산하는 방식이 있다.