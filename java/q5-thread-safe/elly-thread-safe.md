# 자바의 멀티 쓰레드

## 1-1. Thread-safe란 무엇인가요?

특정 쓰레드가 작업을 수행 중일 때, 다른 쓰레드의 실행에 의해 영향을 받지 않게 하는 것

+어떤 자원에 대해 여러 쓰레드가 동시에 접근해도 프로그램 실행에 문제가 없다.

+교착 상태를 막을 수 있다.

## 1-2. 그럼 자바에서 공유 자원에 대해 어떻게 thread-safe 하게 할까요? 

**Synchronized** 키워드를 통해 실행 중인 메소드 or 메소드 안의 특정 블록에 락을 건다.

```java
public synchronized void foo() { ... } //메소드에 동기화 락이 걸린다.
```

```java
public void foo() {
  	synchronized(this) {
      ...//동기화할 로직
    }
}
```





## 1-3. 방금 말한 Synchronized는 어떻게 구현되어 있을까요?

하나의 쓰레드가 실행 중이고, 실행이 끝날 때까지 다른 쓰레드들은 모두 stop해야 한다.

=> 교착 상태를 막기 위한 알고리즘이 포함될 것 같다.

=> Mutex, Semaphore 이런 데드락을 피하기 위한 기술을 사용하지 않을까~ 싶소





## 1-4. Synchronized의 단점은 무엇이 있을까요?

느리다!

하나의 쓰레드가 안전하게 실행되는 것을 보장하지만, 그동안 다른 쓰레드의 실행을 막고 있기 때문에 쓰레드를 병렬적으로 처리할 수 없다.

❓어차피 멀티 쓰레드여도 동시에 처리 못하잖아!!!! 동시/병렬 다른건가?

❗️동시/병렬 모두 하나의 작업(task)에 대해 여러 일꾼(thread)이 돌아가는 건 맞다.  

​	 *병렬(Parallel)* : 여러 쓰레드가 동시간대에 진행될 수 있다. (특정 시각에 n 개의 쓰레드가 힙의 특정 변수에 접근 가능 -> lock/unlock이 필요하다.)  
​	 *동시(Concurrency)* :  특정 시간에 수행되는 쓰레드는 하나이다. 다른 쓰레드들은 잠시 대기한다. 

## 1-5. 말한 단점 외에도 Synchronized를 자주 쓰지 않는 이유는 뭘까요?

몰라...



## 1-6. Synchronized의 단점을 커버하는 방식은 뭐가 있나요?

**병렬 컬렉션(java.util.concurrent 내부에 존재)** 사용하기!

ex. ConcurrentHashMap

`Vector`나 `Hashtable` 등 동기화된 컬렉션 사용은 반드시 1개의 쓰레드만 사용하게 되어 있었으므로 성능 이슈가 발생한다.



❓그럼 공유 자원을 최대한 안 만드는게 좋은거야?

❗️yes yes 읽기 전용 객체(= 불변 객체)를 공유하자.





> **임계 영역**

여러 개의 쓰레드가 동시에 접근할 수 있는 영역

> **교착 상태 (Deadlock)**

교착상태 발생 조건 4가지. 아래의 조건을 동시에 충족할 때 발생한다.

1. **상호배제 (Mutual Exclusion)**

   한 자원에 대해 여러 프로세스 동시 접근이 불가하다.

2. **점유와 대기 (Hold and Wait)**

   자원을 갖고 있는 상태에서 다른 프로세스가 사용하고 있는 자원의 반납을 기다린다

3. **비선점 (Non-Preemptive)**

   다른 프로세스의 자원을 강제로 가져올 수 없다

4. **환형 대기 (Circle Wait)**

   각 프로세스가 순환적으로 다음 프로세스가 요구하는 자원을 가지고 있는 것







<br>

> 참고  
> https://junsday.tistory.com/32  
> https://jeong-pro.tistory.com/156