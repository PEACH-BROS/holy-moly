# Primary Key vs Unique Key

## 내 생각

PK와 UK는 둘다 여러개의 컬럼을 묶어서 사용할 수 있고, table내에 고유한 값을 가지고 있어야 한다.

겉으로 드러나 보이는 차이점은 UK의 경우 PK와 다르게 nullable 하게 설정할 수 있다는점이다.

내부적으로는 이제 Index를 어떻게 타느냐의 차이일 것 같은데 PK는 클러스터링이 되어서 가장 빠른 검색이 가능한 것으로 알고있다.

하지만 UK는 PK처럼 클러스터링이 되어 있지 않아서 그 만큼 빠르지는 못한 것으로 알고 있다. (클러스터링이 될 수 있는 키는 table당 하나인것으로 알고 있다.)

## 찾아본 결과

### PK : 클러스터링 인덱스

*Real MySQL의 5.9 클러스터링 인덱스를 찾아보았다.*

먼저 클러스터링은 비슷한 값들을 군집화 해놓는 것을 의미한다.  
즉, 클러스터링 인덱스는 자주 사용되는 인덱스를 클러스터링 한것을 의미한다. (자주사용하는 것들은 가까이 있다는 점에서 착안했다고한다.)  
클러스터링 인덱스는 InnoDB와 TokuDB 스토리지 엔진에서만 지원을 하는 기능이다.

클러스터링 인덱스란 테이블의 PK에만 적용되는 내용이다.  
결국 PK이 비슷한 레코드끼리 묶어서 저장한 것을 클러스터링 인덱스라고 부르게 된다.

이러한 PK에 의해 레코드의 저장 위치가 결정이 되기 때문에 PK가 변경되면,  
레코드의 물리적 저장 위치도 변경된다는 것을 의미하게 된다. (클러스터가 변경되기 때문에)

따라서 클러스터링 인덱스의 경우 키를 이용한 조회는 클러스터링의 효과를 보기때문에 빠르지만 변경은 상대적으로 느리다.

#### 보조키 (Secondary Key)

유니크 키를 보기에 앞서 보조키에 대해 조금만 알고 가자.

우리가 보통 만드는 Index를 의미하는데 이러한 인덱스를 생성하고 인덱스를 이용하여 조회를 하면 조회 쿼리의 성능이 올라가는 것을 알고 있다.

그렇다면 어떻게 빨라지는 것일까?

보조키는 `보조키-실제 레코드의 주소`를 쌍으로 가지고 있는 것이 아니라 `보조키-클러스터링 키`를 쌍으로 가지고 있기 때문에 빠른것이다.  
보조키를 이용해서 검색을 하면 보조키에 있는 클러스터링 키로 검색하는 구조인 것이다.

#### 주의점

클러스터링 키는 조회에 대해 막강한 기능을 제공하지만 그만큼 주의해야한다.

##### 크기

모든 보조키는 클러스터링 인덱스를 가지게 된다는 것을 의미한다.  
따라서 클러스터링 인덱스의 크기가 커지면 보조키 자체의 크기도 커지게된다.

##### 가능하면 `AUTO_INCREMENT` 보다 업무적인 컬럼을 사용하자. 가능하면!

물론 인덱스(보조키)로 검색을 하면 속도는 빠르다.  
그리고 당연히 PK로 검색하는게 더 빠르다.

##### 반드시 PK를 명시하자

InnoDB의 경우 **PK를 명시하지 않으면** `AUTO_INCREMENT` 같은 **자동 증가 컬럼을 추가**한다.  
그런데 이 자동 증가 컬럼은 노출이 되지 않아서 사용할 수가 없다.  
결국 사용자가 만드는 것만 못한 상태가 되는 것이다.

##### `AUTO_INCREMENT` 를 인위적인 PK로 사용하는 경우

PK의 크기가 큰 경우(여러개의 컬럼을 복합으로 사용할 경우)인데 또 다른 인덱스가 필요하다면 PK를 `AUTO_INCREMENT`로 교체하는 것이 나은 선택일 수 있다.

### UK : 단순히 제약조건

제약조건으로써 같은 인덱스가 2개이상 저장될 수 없음을 의미한다.

**UK의 경우 null을 허용하는데 null은 특정한 값을 나타내지 않기 때문에 2개이상 저장될 수 있다.**

그리고 일반 보조키와 구조상 아무런 차이점이 없다.

따라서 꼭 하나만 존재해야하는 유일성을 보장해야하는 컬럼이 아니라면 굳이 유니크 키를 생성할 필요는 없고 단순히 보조키를 생성해도 된다.