# B-Tree에 대해서 알아보자

[스티치의 B-Tree](stitch.md)

[비밥의 B-Tree](bebop.md)

[엘리의 B-Tree](elly-b-tree.md)

## B-Tree란?

B-Tree는 인덱스를 이루고 있는 자료구조의 일종이다.

### 정의

- 데이터를 정렬하여 탐색, 삽입, 삭제 및 순차 접근이 가능하도록 유지하는 트리형 자료구조이다.
- **트리의 루트로부터 하나의 노드에 이르는 모든 경로가 일정한 깊이를 유지하며 데이터의 접근 시간이 동일**하다.
- 'B'는 Balance의 의미이며, leaf node가 한쪽 방향으로 쏠리는 현상(skewed)이 적다.
- 이진 트리는 자식 노드가 최대 2개인 트리를 말하는 것이면 B-Tree는 자식 노드의 개수가 2개 이상인 트리를 말한다.
- 노드 내의 데이터 개수에 따라 **N차 B-Tree**라고 한다.
  - 차수가 홀수인지 짝수인지에 따라 알고리즘이 많이 달라진다.

### 특징

- 각 노드는 1/2 이상 채워져야 하며, 모든 leaf node는 같은 level에 있다.
- 탐색, 추가, 삭제는 root node로부터 시작한다.
- 노드 내 값은 오름차순을 유지한다.
- 공백이거나 높이가 1이상인 m-원 탐색 트리(m-way search tree)
- root와 leaf를 제외한 내부 노드는 최소 [m/2], 최대 m개의 서브 트리를 가지며, 적어도 [m/2] - 1개의 키 값을 가짐
  - 적어도 반 이상이 키 값으로 채워져 있어야 한다.
- 루트는 그 자체가 리프가 아닌 이상 적어도 두 개의 서브트리를 가진다.
- 모든 리프는 같은 레벨에 있다.

### 구조

![B-Tree structure 2](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fcikell%2FbtqBRvDU1xF%2FCdIhvg8XEhHKaP23vE4Ju1%2Fimg.jpg)

- B-Tree는 데이터가 정렬된 상태로 유지되는 자료구조이다.
- 가장 상단의 노드를 **루트 노드(Root Node)**, 중간 노드들을 **브랜치 노드(Branch Node)** 또는 **인터널 노드(Internal Node)**, 가장 아래 노드들을 **리프 노드(Leaf Node)**라고 한다.
- 한 노드당 자식 노드가 2개 이상 가능하다.
- key 값을 이용해 찾고자 하는 데이터를 트리 구조를 이용해 찾는다.

<br/>

## B-Tree의 장단점 및 활용

### 장점

- 균등한 탐색 속도 보장이 가능하다.
  - 데이터의 개수가 N개라면 시간 복잡도는 O(logN)이다.
- 삽입, 삭제 후에도 균형 트리를 유지한다.
  - B-Tree는 처음 생성때는 균형 트리이지만 삽입, 삭제, 수정의 반복을 통해 균형이 깨지고 성능도 악화된다.
  - 자동적으로 균형을 회복하는 기능이 있지만 갱신 빈도가 높은 테이블의 인덱스의 경우에는 인덱스 재구성을 해서 트리의 균형을 되찾는 작업이 필요하다.

### 단점

- 노드 삽입과 삭제 시 트리의 균형을 유지하기 위해 복잡한 연산(재분배, 합병)이 필요하다.
- 순차 탐색시에 중위(In-Order) 순회로 비효율적이다.
  - B+Tree 구조에서 리프 노드간의 Linked List로 순차 탐색 효율이 향상되었다.

### 활용

- DBMS의 인덱스 자료구조로 활용된다(B+Tree, B*Tree로 발전 적용).
- 검색엔진, 패턴 매칭 등 빠르면서도 성능이 일정하게 유지되는 탐색이 요구되는 분야에 활용된다.

<br/>

## 근데 내가 알고(하고) 싶은건 사실 B+ - Tree

DB에서 테이블을 구현 할 때 사용하는 자료구조

Index 노드와 Data 노드로 구성이 되어있다.  
당연히 Data 노드가 실제 레코드의 디스크 주소를 가리킨다.  
그리고 Data 노드가 Leaf 노드를 의미한다.

그리고 Data 노드는 LinkedList 형태로 연결되어 있어서 순차 집합이라 불리며 오름차순으로 정렬이 되어 있다.

### 인덱스 세트와 순차 세트

#### **인덱스 세트** : 실제적인 키 값(Leaf node)를 찾아갈 수 있는 경로제공이 목적

인덱스 세트에 있는 키 값 : **리프 노드에 있는 키 값을 찾아가는 경로만 제공하기 위해서 사용**

인덱스 세트의 노드와 순차 세트의 노드는 그 내부 구조가 서로 다름

인덱스 세트에 있는 노드 : 키 값만 저장, 리프 노드 : 키 값과 포인터가 함께 저장

#### **순차 세트** : 정렬된 키와 데이터만 존재한다.

Leaf Node값은 오름차순으로 정렬되어 있으며, 삽입으로 인한 분기 시 Sequence Set에 연결되면서, 순차성 유지 : 성능 저하 해결

각각의 노드는 순차접근을 할 수 있도록 링크되어 순차접근이 용이

![image](https://user-images.githubusercontent.com/13347548/89920474-68560000-dc37-11ea-8cd4-e836f0e297be.png)