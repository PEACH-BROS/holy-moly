# B-Tree에 대하여

## B-Tree란?

B-Tree는 인덱스를 이루고 있는 자료구조의 일종이다.

### 정의

- 데이터를 정렬하여 탐색, 삽입, 삭제 및 순차 접근이 가능하도록 유지하는 트리형 자료구조이다.
- **트리의 루트로부터 하나의 노드에 이르는 모든 경로가 일정한 깊이를 유지하며 데이터의 접근 시간이 동일**하다.
- 'B'는 Balance의 의미이며, leaf node가 한쪽 방향으로 쏠리는 현상(skewed)이 적다.
- 이진 트리는 자식 노드가 최대 2개인 트리를 말하는 것이면 B-Tree는 자식 노드의 개수가 2개 이상인 트리를 말한다.
- 노드 내의 데이터 개수에 따라 **N차 B-Tree**라고 한다.
  - 차수가 홀수인지 짝수인지에 따라 알고리즘이 많이 달라진다.

### 특징

- 각 노드는 1/2 이상 채워져야 하며, 모든 leaf node는 같은 level에 있다.
- 탐색, 추가, 삭제는 root node로부터 시작한다.
- 노드 내 값은 오름차순을 유지한다.
- 공백이거나 높이가 1이상인 m-원 탐색 트리(m-way search tree)
- root와 leaf를 제외한 내부 노드는 최소 [m/2], 최대 m개의 서브 트리를 가지며, 적어도 [m/2] - 1개의 키 값을 가짐
  - 적어도 반 이상이 키 값으로 채워져 있어야 한다.
- 루트는 그 자체가 리프가 아닌 이상 적어도 두 개의 서브트리를 가진다.
- 모든 리프는 같은 레벨에 있다.

### 구조

![B-Tree structure 2](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fcikell%2FbtqBRvDU1xF%2FCdIhvg8XEhHKaP23vE4Ju1%2Fimg.jpg)

- B-Tree는 데이터가 정렬된 상태로 유지되는 자료구조이다.
- 가장 상단의 노드를 **루트 노드(Root Node)**, 중간 노드들을 **브랜치 노드(Branch Node)** 또는 **인터널 노드(Internal Node)**, 가장 아래 노드들을 **리프 노드(Leaf Node)**라고 한다.
- 한 노드당 자식 노드가 2개 이상 가능하다.
- key 값을 이용해 찾고자 하는 데이터를 트리 구조를 이용해 찾는다.

## B-Tree의 장단점 및 활용

### 장점

- 균등한 탐색 속도 보장이 가능하다.
  - 데이터의 개수가 N개라면 시간 복잡도는 O(logN)이다.
- 삽입, 삭제 후에도 균형 트리를 유지한다.
  - B-Tree는 처음 생성때는 균형 트리이지만 삽입, 삭제, 수정의 반복을 통해 균형이 깨지고 성능도 악화된다.
  - 자동적으로 균형을 회복하는 기능이 있지만 갱신 빈도가 높은 테이블의 인덱스의 경우에는 인덱스 재구성을 해서 트리의 균형을 되찾는 작업이 필요하다.
- 효율적인 알고리즘을 제공한다.
- 저장 장치가 효율적이다.

### 단점

- 노드 삽입과 삭제 시 트리의 균형을 유지하기 위해 복잡한 연산(재분배, 합병)이 필요하다.
- 순차 탐색시에 중위(In-Order) 순회로 비효율적이다.
  - B+Tree 구조에서 리프 노드간의 Linked List로 순차 탐색 효율이 향상되었다.

### 활용

- DBMS의 인덱스 자료구조로 활용된다(B+Tree, B*Tree로 발전 적용).
- 검색엔진, 패턴 매칭 등 빠르면서도 성능이 일정하게 유지되는 탐색이 요구되는 분야에 활용된다.

## B-Tree의 연산

### 삽입

![B-Tree Insert](https://hyungjoon6876.github.io/jlog/assets/img/20180720/btree_6.png)

1. 초기 삽입시는 루트 노드를 생성한다.
2. 데이터를 탐색해 해당하는 리프 노드에 삽입한다.
3. 리프 노드에 데이터가 가득 차 있으면 노드를 분리한다.
   - 노드가 가득찬다는 것은 `노드 데이터의 개수 == 차수` 이다.
   - <u>insert 7</u>에서 노드가 [1, 5, 7]로 가득찼다.
   - 정렬된 노드를 기준으로 중간 값을 부모 노드로 해서 트리를 구성한다.
4. 분리한 서브트리가 B-Tree 조건에 맞지 않는다면 부모 노드로 올라가며 merge 한다.
   - <u>insert 12</u>에서 [9, 7, 12]를 서브트리로 분리하였다.
   - 노드가 가득차있기 때문에 중간 값을 부모 노드로 해서 트리를 구성한다.
   - 리프 노드(1, 7, 12)가 모두 같은 레벨에 존재하지 않게 되었다.
   - [7, 12]의 부모 노드인 [9]를 루트 노드에 merge 시켰다.

### 삭제

`To Be Continue...`

